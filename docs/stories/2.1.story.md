# Story 2.1: Build AI Questionnaire Interface

## Status
Approved

## Story
**As a** user,
**I want** to interact with an AI questionnaire through a conversational interface,
**so that** I can complete business discovery in an engaging, chat-like experience

## Acceptance Criteria
1. Chat interface displays conversation history with AI and user messages
2. Progress indicator shows current question number and completion percentage
3. Messages auto-scroll to latest with smooth animation
4. Input area supports text entry with auto-resize
5. Quick response buttons appear for common answers
6. Session state is saved automatically every response
7. Mobile-responsive design works on all screen sizes
8. Typing indicator shows when AI is processing

## Tasks / Subtasks
- [ ] Create questionnaire page structure (AC: 1, 7)
  - [ ] Set up /questionnaire route
  - [ ] Create QuestionnaireLayout component
  - [ ] Implement responsive container with max-width
- [ ] Build message display components (AC: 1, 3)
  - [ ] Create MessageBubble component for AI/user messages
  - [ ] Implement message list with virtualization for performance
  - [ ] Add smooth auto-scroll to bottom on new messages
  - [ ] Style message bubbles with proper spacing and colors
- [ ] Implement progress tracking (AC: 2)
  - [ ] Create ProgressHeader component
  - [ ] Display current question number and total estimate
  - [ ] Show percentage completion bar
  - [ ] Add save/exit buttons to header
- [ ] Build input components (AC: 4, 5)
  - [ ] Create MessageInput with auto-resize textarea
  - [ ] Add send button with loading state
  - [ ] Implement quick response buttons
  - [ ] Add character count indicator (500 max)
- [ ] Add typing indicator (AC: 8)
  - [ ] Create TypingIndicator component with animation
  - [ ] Show when awaiting AI response
  - [ ] Hide when response received
- [ ] Implement state management (AC: 6)
  - [ ] Set up questionnaire context with Zustand
  - [ ] Store conversation history in state
  - [ ] Auto-save to Supabase on each response
  - [ ] Handle session resume from saved state
- [ ] Add keyboard interactions (AC: 4)
  - [ ] Enter key sends message (Shift+Enter for new line)
  - [ ] Escape key clears input
  - [ ] Tab navigation through quick responses
- [ ] Style for mobile-first (AC: 7)
  - [ ] Ensure touch-friendly button sizes
  - [ ] Test on various mobile devices
  - [ ] Handle virtual keyboard properly
  - [ ] Add pull-to-refresh for session sync

## Dev Notes
### UI Components Structure
[Source: frontend/2-ai-questionnaire-interface.md]

```
app/questionnaire/
â”œâ”€â”€ page.tsx              # Main questionnaire page
â”œâ”€â”€ layout.tsx            # Questionnaire-specific layout
components/questionnaire/
â”œâ”€â”€ ProgressHeader.tsx    # Progress bar and navigation
â”œâ”€â”€ MessageList.tsx       # Scrollable message container
â”œâ”€â”€ MessageBubble.tsx     # Individual message component
â”œâ”€â”€ MessageInput.tsx      # Input area with actions
â”œâ”€â”€ TypingIndicator.tsx   # AI thinking animation
â”œâ”€â”€ QuickResponses.tsx    # Suggested response buttons
â””â”€â”€ SaveIndicator.tsx     # Auto-save status
```

### Message Bubble Design
[Source: frontend/2-ai-questionnaire-interface.md#conversation-components]

AI messages:
- Left-aligned with AI avatar (ðŸ¤–)
- Light background (surface color)
- Include timestamp
- May contain QuickResponse buttons

User messages:
- Right-aligned without avatar
- Primary color background
- White text for contrast
- Include timestamp

### State Management
Use Zustand for questionnaire state:
```typescript
interface QuestionnaireState {
  sessionId: string;
  messages: Message[];
  currentQuestionIndex: number;
  totalQuestions: number;
  isTyping: boolean;
  addMessage: (message: Message) => void;
  setTyping: (typing: boolean) => void;
  saveSession: () => Promise<void>;
}
```

### Auto-Save Logic
- Save after each user response
- Debounce saves by 2 seconds
- Show save indicator in header
- Handle offline with local storage fallback

### Mobile Considerations
[Source: frontend/2-ai-questionnaire-interface.md#mobile-layout-design]
- Fixed header with progress
- Scrollable message area (calc height)
- Fixed input area at bottom
- Account for safe areas on mobile devices
- Virtual keyboard should not cover input

### Accessibility
- Announce new messages to screen readers
- Proper ARIA labels for all buttons
- Focus management when messages arrive
- Keyboard navigation for quick responses
- High contrast mode support

### Testing
- Test message scrolling behavior
- Verify auto-save works correctly
- Test on various mobile devices
- Check keyboard navigation
- Validate progress calculation
- Test session resume functionality

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-17 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_
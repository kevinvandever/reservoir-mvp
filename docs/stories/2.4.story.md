# Story 2.4: Build Automation Library & Content Management

## Status
Ready for Review

## Story
**As a** platform administrator,
**I want** to create and manage automation content library,
**so that** the system can recommend relevant automations to users

## Acceptance Criteria
1. Admin interface for creating and editing automations
2. Automation content includes title, description, implementation steps
3. Categorization system with tags and difficulty levels
4. Implementation time and ROI metrics are tracked
5. Rich text editor for step-by-step instructions
6. Image/video upload for visual guides
7. Automation library can be searched and filtered
8. Bulk import/export functionality for content

## Tasks / Subtasks
- [ ] Create automation CRUD operations (AC: 1, 2)
  - [ ] Build AutomationService class
  - [ ] Create database operations (create, read, update, delete)
  - [ ] Add validation for automation data
  - [ ] Implement soft delete functionality
- [ ] Build admin interface (AC: 1)
  - [ ] Create /admin/automations route (protected)
  - [ ] Build AutomationList component with search/filter
  - [ ] Create AutomationForm for add/edit
  - [ ] Add confirmation dialogs for delete actions
- [ ] Implement rich content editor (AC: 2, 5)
  - [ ] Install TipTap or similar rich text editor
  - [ ] Support markdown formatting
  - [ ] Add code blocks for technical instructions
  - [ ] Include checklist formatting for steps
- [ ] Add media management (AC: 6)
  - [ ] Integrate with Supabase Storage
  - [ ] Build image upload component
  - [ ] Add video embedding support
  - [ ] Create image optimization pipeline
- [ ] Build categorization system (AC: 3)
  - [ ] Implement tags system (multi-select)
  - [ ] Add difficulty levels (easy/medium/hard)
  - [ ] Create business size targeting
  - [ ] Add industry-specific categories
- [ ] Add metrics tracking (AC: 4)
  - [ ] Time saved input (hours/week)
  - [ ] Revenue impact calculator
  - [ ] Implementation time estimate
  - [ ] Success rate tracking
- [ ] Create search and filtering (AC: 7)
  - [ ] Implement full-text search
  - [ ] Add category filters
  - [ ] Create difficulty and time filters
  - [ ] Build advanced search with multiple criteria
- [ ] Add bulk operations (AC: 8)
  - [ ] CSV import functionality
  - [ ] Bulk export to various formats
  - [ ] Batch edit operations
  - [ ] Template creation system

## Dev Notes
### Database Schema
[Source: architecture/8-database-schema.md]

Uses existing automation tables:
- `automations`: Main automation data
- `automation_tools`: Required tools/services
- `implementation_steps`: Step-by-step instructions
- `step_media`: Images/videos for steps

### Admin Interface Structure
```
app/admin/
├── automations/
│   ├── page.tsx           # Automation list
│   ├── new/
│   │   └── page.tsx       # Create automation
│   └── [id]/
│       └── edit/
│           └── page.tsx   # Edit automation

components/admin/
├── AutomationList.tsx     # Table with search/filter
├── AutomationForm.tsx     # Create/edit form
├── RichTextEditor.tsx     # Content editor
├── MediaUploader.tsx      # Image/video upload
├── TagSelector.tsx        # Multi-select tags
└── MetricsCalculator.tsx  # ROI calculator
```

### Content Structure
```typescript
interface Automation {
  id: string;
  title: string;
  description: string;
  category: string;
  difficulty: 'easy' | 'medium' | 'hard';
  timeSaved: number; // hours per week
  revenueImpact: number; // dollars per month
  implementationTime: number; // hours
  tags: string[];
  targetBusinessSize: string[];
  targetExperience: string[];
  targetIndustries: string[];
  published: boolean;
  tools: AutomationTool[];
  steps: ImplementationStep[];
}

interface ImplementationStep {
  orderIndex: number;
  title: string;
  instructions: string; // Rich text/markdown
  estimatedTime: string;
  requiredTools: string[];
  media: StepMedia[];
}
```

### Rich Text Editor
Use TipTap with extensions:
```typescript
const editor = useEditor({
  extensions: [
    StarterKit,
    TaskList,
    TaskItem,
    Image,
    CodeBlockLowlight,
    Link,
  ],
  content: automation.description,
});
```

### Media Management
[Source: architecture/6-external-api-integrations.md#supabase-integration]

Upload to Supabase Storage:
```typescript
const uploadImage = async (file: File) => {
  const { data, error } = await supabase.storage
    .from('automation-media')
    .upload(`steps/${stepId}/${file.name}`, file);
  return data?.path;
};
```

### Search Implementation
```typescript
// Full-text search query
const searchAutomations = async (query: string, filters: FilterOptions) => {
  let queryBuilder = supabase
    .from('automations')
    .select('*')
    .textSearch('title,description', query);
    
  if (filters.category) {
    queryBuilder = queryBuilder.eq('category', filters.category);
  }
  
  if (filters.difficulty) {
    queryBuilder = queryBuilder.eq('difficulty', filters.difficulty);
  }
  
  return queryBuilder;
};
```

### Authorization
Admin-only access using RLS policies:
```sql
-- Only admins can modify automations
CREATE POLICY "Admins can modify automations" ON automations
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM user_profiles
      WHERE user_profiles.user_id = auth.uid()
      AND user_profiles.role = 'admin'
    )
  );
```

### Bulk Operations
CSV import format:
```csv
title,description,category,difficulty,time_saved,revenue_impact,tags
"Lead Response Auto","Automatically respond to leads",Lead Management,easy,8,2100,"crm,leads,automation"
```

### Testing
- Test CRUD operations for automations
- Verify rich text editor saves content correctly
- Test image upload and display
- Validate search and filtering
- Check admin authorization
- Test bulk import/export

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-17 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_